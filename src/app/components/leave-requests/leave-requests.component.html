<div class="leave-table-card">
  <!-- <div class="card-header">
    <h2 class="card-title" id="titre-demandes">Demandes de congés</h2>
  </div> -->

  <!-- Indicateur de chargement -->
  <div *ngIf="loading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Chargement des demandes...</p>
  </div>

  <!-- Contenu principal -->
  <div *ngIf="!loading" class="table-container">
    <table class="leave-table">
      <thead>
        <tr>
          <th class="col-select">
            <!-- <div class="select-header">
              <input
                type="checkbox"
                class="select-all-checkbox"
                (change)="onSelectAll($event)"
              />
              <div class="vertical-line"></div>
            </div> -->
          </th>
          <th class="col-user">User</th>
          <th class="col-type">Type de congé</th>
          <th class="col-date">Date de départ</th>
          <th class="col-duration">Durée</th>
          <th class="col-status">Status</th>
          <th class="col-action">Action</th>
        </tr>
      </thead>
      <tbody>
        <ng-container
          *ngFor="
            let request of leaveRequests;
            let i = index;
            trackBy: trackByRequestId
          "
        >
          <!-- Ligne principale -->
          <tr class="table-row">
            <td class="select-cell">
              <div class="select-container" [class.pr-0]="i === 0">
                <input
                  type="checkbox"
                  class="row-checkbox"
                  (change)="onRowSelect(i, $event)"
                />
                <div class="vertical-line"></div>
              </div>
            </td>
            <td class="user-cell">
              <div class="user-info" (click)="onUserClick(i, $event)">
                <div
                  class="min-user-avatar"
                  [class]="getUserAvatarClass(request)"
                >
                  <img
                    [src]="
                      request.employee?.profilePicture ||
                      'assets/images/default-avatar.svg'
                    "
                    [alt]="'Avatar de ' + getFullName(request)"
                    class="avatar-image"
                    (error)="handleImageError($event)"
                  />
                </div>
                <div class="user-details">
                  <div class="user-name">{{ getFullName(request) }}</div>
                  <div class="user-email">
                    {{ request.employee?.email || "N/A" }}
                  </div>
                </div>
              </div>
            </td>
            <td>{{ LEAVE_TYPE_LABELS[request.leaveType] }}</td>
            <td>{{ formatDate(request.startDate) }}</td>
            <td>{{ getDurationText(request.totalDays) }}</td>
            <td>
              <span
                class="status-chip d-flex align-items-center justify-content-center"
                [class]="getStatusClass(request.status)"
              >
                <img
                  [src]="getStatusIcon(request.status)"
                  [alt]="LEAVE_STATUS_LABELS[request.status]"
                  class="status-icon"
                />
                {{ LEAVE_STATUS_LABELS[request.status] }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button
                  class="action-btn edit"
                  title="Modifier l'employé"
                  (click)="openEditModal(request.employee!)"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="m18 2 4 4-12 12H6v-4z" />
                    <path d="m21.5 6.5-3.5-3.5M2 18h3l12-12" />
                  </svg>
                </button>
                <button class="action-btn more" title="Plus d'options">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="1" />
                    <circle cx="12" cy="5" r="1" />
                    <circle cx="12" cy="19" r="1" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>

          <!-- Ligne étendue avec nom d'utilisateur -->
          <tr *ngIf="isRowExpanded(i)" class="expanded-row">
            <td colspan="7" class="expanded-content">
              <div class="row">
                <div class="col-lg-8 border-end-section">
                  <app-employee-profile
                    [employee]="selectedEmployee"
                  ></app-employee-profile>
                </div>
                <div class="col-lg-4">
                  <app-leave-analytics
                    [employee]="selectedEmployee"
                  ></app-leave-analytics>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <!-- Message si aucune demande -->
    <div *ngIf="leaveRequests.length === 0" class="no-requests">
      <p>Aucune demande de congé trouvée.</p>
    </div>
  </div>

  <!-- Footer avec pagination -->
  <div *ngIf="!loading" class="table-footer">
    <div class="table-info">
      Affichage de {{ (currentPage - 1) * pageSize + 1 }}–{{
        Math.min(currentPage * pageSize, totalRequests)
      }}
      sur {{ totalRequests }} demandes
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <button
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="previousPage()"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="15,18 9,12 15,6" />
        </svg>
      </button>

      <button
        *ngFor="let page of pages; trackBy: trackByPageNumber"
        class="pagination-btn page-number"
        [class.active]="page === currentPage"
        (click)="changePage(page)"
      >
        {{ page }}
      </button>

      <button
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="9,18 15,12 9,6" />
        </svg>
      </button>
    </div>
  </div>
</div>
